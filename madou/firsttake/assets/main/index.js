System.register("chunks:///_virtual/FaceTrackingManager3D.ts",["./rollupPluginModLoBabelHelpers.js","cc","./vision_bundle.mjs","./WebcamTexture.ts"],(function(e){var t,a,r,n,i,o,s,c,u,l,p,f,d,m,h,g,v,M,k;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,u=e.Node,l=e.Camera,p=e.view,f=e.math,d=e.Vec3,m=e.Mat4,h=e.Quat,g=e.Component},function(e){v=e.FaceLandmarker,M=e.FilesetResolver},function(e){k=e.WebcamTexture}],execute:function(){var y,w,x,b,D,F,T,_,P;s._RF.push({},"e89a2USrTtByKZVMQCimkAD","FaceTrackingManager3D",void 0);var L=c.ccclass,R=c.property;e("FaceTrackingManager3D",(y=L("FaceTrackingManager3D"),w=R(k),x=R(u),b=R(l),y((T=t((F=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,r(t,"webcamSvc",T,n(t)),r(t,"target3DNode",_,n(t)),r(t,"mainCamera",P,n(t)),t.faceLandmarker=null,t._currentFacingMode="environment",t}a(t,e);var s=t.prototype;return s.start=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMediaPipe();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.initMediaPipe=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");case 2:return t=e.sent,e.next=5,v.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},outputFacialTransformationMatrixes:!0,runningMode:"VIDEO",numFaces:1});case 5:this.faceLandmarker=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.update=function(e){var t=this.webcamSvc._video;if(this.faceLandmarker&&t&&4===t.readyState){var a=this.faceLandmarker.detectForVideo(t,performance.now());a.faceLandmarks&&a.faceLandmarks.length>0&&(this.update3DPosition(a.faceLandmarks[0]),a.facialTransformationMatrixes&&a.facialTransformationMatrixes.length>0&&this.update3DRotationOnly(a.facialTransformationMatrixes[0].data))}},s.update3DPosition=function(e){var t=e[1],a=e[33],r=e[263],n=p.getVisibleSize(),i=n.width/n.height,o="user"===this._currentFacingMode?1-t.x:t.x,s=1-t.y,c=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2))/.25*5-19;c=f.clamp(c,-19,-8);var u=this.mainCamera.fov/2*(Math.PI/180),l=Math.tan(u)*Math.abs(c),m=(2*o-1)*(l*i),h=(2*s-1)*l,g=new d(m,h,c);this.target3DNode.setPosition(g),console.log("3D Position: X="+m.toFixed(2)+", Y="+h.toFixed(2)+", Z="+c.toFixed(2))},s.update3DRotationOnly=function(e){var t=new m;m.set(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]);var a=new h;if(t.getRotation(a),"user"===this._currentFacingMode){var r=new d;a.getEulerAngles(r),h.fromEuler(a,r.x,-r.y,-r.z)}this.target3DNode.setRotation(a)},t}(g)).prototype,"webcamSvc",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(F.prototype,"target3DNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(F.prototype,"mainCamera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=F))||D));s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./FaceTrackingManager3D.ts","./PlaneFitter.ts","./QuizManager.ts","./WebcamTexture.ts"],(function(){return{setters:[null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlaneFitter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r,n,a,o,c,s,l,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,c=t.Camera,s=t.Vec3,l=t.view,u=t.Component}],execute:function(){var p,f,h,d,g,m,y,v;a._RF.push({},"dc11eGUx9pOfqreWjtr3Qto","PlaneFitter",void 0);var P=o.ccclass,C=o.property,b=o.executeInEditMode;t("PlaneFitter",(p=P("PlaneFitter"),f=b(!0),h=C(c),d=C({tooltip:"是否每一幀都重新計算 (若相機 FOV 或 Plane 位置會變動則勾選)"}),p(g=f((y=e((m=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,r(e,"targetCamera",y,n(e)),r(e,"isDynamic",v,n(e)),e}i(e,t);var a=e.prototype;return a.start=function(){this.fit()},a.update=function(t){(this.isDynamic||CC_EDITOR)&&this.fit()},a.fit=function(){if(this.targetCamera&&this.node){var t=this.targetCamera.node.worldPosition,e=this.node.worldPosition,i=s.distance(t,e);if(!(i<=0)){var r=this.targetCamera.fov,n=l.getVisibleSize(),a=n.width/n.height,o=r/2*(Math.PI/180),c=2*Math.tan(o)*i,u=c*a/10,p=c/10;this.node.setScale(new s(u,1,p))}}},e}(u)).prototype,"targetCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(m.prototype,"isDynamic",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=m))||g)||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/QuizManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,o,r,s,l,a,u,c,p,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,l=t.Label,a=t.Button,u=t.Node,c=t.EventHandler,p=t.Color,h=t.Component}],execute:function(){var d,b,g,f,x,v,B,L,w,_,y,z,C,I,m,Q,S,O,q;r._RF.push({},"34530+z/RJByL2nJOR528Y2","QuizManager",void 0);var P=s.ccclass,D=s.property,k=[{id:"1",title:"Q1｜此刻你的「能量 × 感受」最接近哪一格？",question:"請依照此刻的感覺作答；沒有標準答案。",options:[{id:"A",text:"高能量 × 不舒服（焦躁、緊張）"},{id:"B",text:"高能量 × 舒服（興奮、期待）"},{id:"C",text:"低能量 × 不舒服（沮喪、疲倦）"},{id:"D",text:"低能量 × 舒服（平靜、放鬆）"}]},{id:"2",title:"Q2｜此刻你最明顯的身體訊號是？",question:"",options:[{id:"A",text:"心跳偏快／手心出汗"},{id:"B",text:"肩頸僵硬／下顎緊繃"},{id:"C",text:"呼吸變淺／胸口發緊"},{id:"D",text:"胃部不適／全身沈重"}]},{id:"3",title:"Q3｜此刻你最需要哪一種支持？",question:"",options:[{id:"A",text:"先穩定身體感受（呼吸放鬆）"},{id:"B",text:"把事情排出來（訂下行動步驟）"},{id:"C",text:"有人支持著我／靠著一下（被支持感）"},{id:"D",text:"一個調整與自我修復的空間"}]}];t("QuizManager",(d=P("QuizManager"),b=D(l),g=D(l),f=D([a]),x=D([l]),v=D(a),B=D(l),L=D(u),w=D(l),d((z=e((y=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"titleLabel",z,o(e)),i(e,"questionLabel",C,o(e)),i(e,"optionBtns",I,o(e)),i(e,"optionLabels",m,o(e)),i(e,"nextButton",Q,o(e)),i(e,"progressLabel",S,o(e)),i(e,"resultPanel",O,o(e)),i(e,"resultLabel",q,o(e)),e._currentIndex=0,e._selectedOptionIndex=-1,e._answers={},e}n(e,t);var r=e.prototype;return r.start=function(){this._currentIndex=0,this._answers={},this.resultPanel&&(this.resultPanel.active=!1),this.showCurrentQuestion();for(var t=0;t<this.optionBtns.length;t++){var e=this.optionBtns[t],n=new c;n.target=this.node,n.component="QuizManager",n.handler="onClickOptionButton",n.customEventData=t.toString(),e.clickEvents.push(n)}this.resetSelectButtons(),this.nextButton.node.on(a.EventType.CLICK,this.onSendButtonClick,this),this._selectedOptionIndex},r.showCurrentQuestion=function(){var t=k[this._currentIndex];if(t){this.titleLabel&&(this.titleLabel.string=t.title),this.questionLabel&&(this.questionLabel.string=t.question||"");for(var e=0;e<this.optionLabels.length;e++){var n=this.optionLabels[e],i=t.options[e];n&&i&&(n.string=i.id+". "+i.text)}this.progressLabel&&(this.progressLabel.string=this._currentIndex+1+" / "+k.length)}},r.onClickOptionButton=function(t,e){var n=parseInt(e,10);console.log(n),this.toggleSelectButton(n),this._selectedOptionIndex=n;var i=k[this._currentIndex];if(i){var o=i.options[n];o&&(this._answers[i.id]=o.id)}},r.onSendButtonClick=function(){-1!=this._selectedOptionIndex?(this._currentIndex<k.length-1?(this._currentIndex++,this.showCurrentQuestion()):this.showResult(),this._selectedOptionIndex=-1,this.resetSelectButtons()):console.log("請先選擇一個選項")},r.toggleSelectButton=function(t){for(var e=0;e<this.optionBtns.length;e++){var n=this.optionBtns[e].getComponent("cc.Sprite");n.color=e==t?new p(0,255,0):new p(255,255,255)}},r.resetSelectButtons=function(){this._selectedOptionIndex;for(var t=0;t<this.optionBtns.length;t++){this.optionBtns[t].getComponent("cc.Sprite").color=new p(255,255,255)}},r.showResult=function(){for(var t="你的作答結果：\n\n",e=0,n=k;e<n.length;e++){var i=n[e],o=this._answers[i.id]||"-";t+=i.id+"：選擇 "+o+"\n"}console.log(t),this.resultLabel&&(this.resultLabel.string=t),this.resultPanel&&(this.resultPanel.active=!0)},e}(h)).prototype,"titleLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(y.prototype,"questionLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(y.prototype,"optionBtns",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=e(y.prototype,"optionLabels",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=e(y.prototype,"nextButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=e(y.prototype,"progressLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(y.prototype,"resultPanel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(y.prototype,"resultLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=y))||_));r._RF.pop()}}}));

System.register("chunks:///_virtual/WebcamTexture.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,a,s,o,c,u,h,d,l,p,v,f,_,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){o=e.cclegacy,c=e._decorator,u=e.Enum,h=e.Sprite,d=e.MeshRenderer,l=e.Texture2D,p=e.SpriteFrame,v=e.Vec3,f=e.UITransform,_=e.Component,m=e.sys}],execute:function(){var y,w,x,b,g,S,D,M,R;o._RF.push({},"d4dc2rhnBJANL+VEGy8SqL6","WebcamTexture",void 0);var T=c.ccclass,z=c.property,P=function(e){return e[e.Sprite_2D=0]="Sprite_2D",e[e.Plane_3D=1]="Plane_3D",e}(P||{});u(P);e("WebcamTexture",(y=T("WebcamTexture"),w=z({type:P,tooltip:"選擇顯示模式：2D Sprite 或 3D Plane"}),x=z({type:h,visible:function(){return this.displayMode===P.Sprite_2D}}),b=z({type:d,visible:function(){return this.displayMode===P.Plane_3D}}),y((D=t((S=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,r(t,"displayMode",D,n(t)),r(t,"cameraSprite",M,n(t)),r(t,"cameraMesh",R,n(t)),t._video=null,t._canvas=null,t._ctx=null,t._texture=null,t._ready=!1,t._resizeRAF=0,t.queueReflow=function(){t._resizeRAF||(t._resizeRAF=requestAnimationFrame((function(){t._resizeRAF=0,t.reflow()})))},t}i(t,e);var o=t.prototype;return o.onLoad=function(){var e=a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m.isBrowser){e.next=2;break}return e.abrupt("return");case 2:return this.setupVideoElement(),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas),this._canvas.style.display="none",e.next=9,this.startCamera("environment");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.setupVideoElement=function(){this._video=document.createElement("video"),this._video.setAttribute("autoplay",""),this._video.setAttribute("muted",""),this._video.setAttribute("playsinline","")},o.startCamera=function(){var e=a(s().mark((function e(t){var i,r,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(i=this._video)&&i.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{facingMode:t},audio:!1});case 4:return r=e.sent,this._video.srcObject=r,e.next=8,new Promise((function(e){n._video.onloadedmetadata=function(){n._video.play(),e()}}));case 8:this.initTexture(),this.setupResizeListeners(),this._ready=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("無法取得攝影機：",e.t0);case 16:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),o.initTexture=function(){var e=this._video.videoWidth,t=this._video.videoHeight;if(this._canvas.width=e,this._canvas.height=t,this._texture=new l,this._texture.reset({width:e,height:t,format:l.PixelFormat.RGB888}),this.displayMode===P.Sprite_2D&&this.cameraSprite){var i=new p;i.texture=this._texture,this.cameraSprite.spriteFrame=i}else if(this.displayMode===P.Plane_3D&&this.cameraMesh){var r=this.cameraMesh.getMaterialInstance(0);r&&r.setProperty("mainTexture",this._texture)}this.reflow()},o.changeCamera=function(){var e=a(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ready=!1,e.next=3,this.startCamera(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),o.setupResizeListeners=function(){var e;window.addEventListener("resize",this.queueReflow),null==(e=this._video)||e.addEventListener("resize",this.queueReflow),this.queueReflow()},o.reflow=function(){this._ready&&this._video&&(this.displayMode===P.Sprite_2D?this.fitSpriteToParentHeight(this._video.videoHeight):this.fitPlaneToVideoRatio())},o.fitPlaneToVideoRatio=function(){if(this.cameraMesh&&this._video){var e=this._video.videoWidth/this._video.videoHeight;this.cameraMesh.node.setScale(new v(e,1,1))}},o.fitSpriteToParentHeight=function(e){var t;if(this.cameraSprite){var i=this.cameraSprite.node,r=null==(t=i.parent)?void 0:t.getComponent(f),n=i.getComponent(f);if(n&&r){n.setContentSize(n.width,e);var a=r.height/e;i.setScale(a,a,1)}}},o.update=function(){this._ready&&this._video&&this._canvas&&this._ctx&&this._texture&&(this._ctx.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),this._texture.uploadData(this._canvas))},o.onDestroy=function(){var e;null!=(e=this._video)&&e.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),window.removeEventListener("resize",this.queueReflow)},t}(_)).prototype,"displayMode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return P.Sprite_2D}}),M=t(S.prototype,"cameraSprite",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(S.prototype,"cameraMesh",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=S))||g));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});