System.register("chunks:///_virtual/FaceTrackingManager3D.ts",["./rollupPluginModLoBabelHelpers.js","cc","./vision_bundle.mjs","./WebcamTexture.ts"],(function(e){var t,a,r,n,i,o,s,c,u,l,p,f,d,m,h,g,v,M,k;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,u=e.Node,l=e.Camera,p=e.view,f=e.math,d=e.Vec3,m=e.Mat4,h=e.Quat,g=e.Component},function(e){v=e.FaceLandmarker,M=e.FilesetResolver},function(e){k=e.WebcamTexture}],execute:function(){var y,w,x,b,D,F,T,_,P;s._RF.push({},"e89a2USrTtByKZVMQCimkAD","FaceTrackingManager3D",void 0);var L=c.ccclass,R=c.property;e("FaceTrackingManager3D",(y=L("FaceTrackingManager3D"),w=R(k),x=R(u),b=R(l),y((T=t((F=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,r(t,"webcamSvc",T,n(t)),r(t,"target3DNode",_,n(t)),r(t,"mainCamera",P,n(t)),t.faceLandmarker=null,t._currentFacingMode="environment",t}a(t,e);var s=t.prototype;return s.start=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMediaPipe();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.initMediaPipe=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");case 2:return t=e.sent,e.next=5,v.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},outputFacialTransformationMatrixes:!0,runningMode:"VIDEO",numFaces:1});case 5:this.faceLandmarker=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.update=function(e){var t=this.webcamSvc._video;if(this.faceLandmarker&&t&&4===t.readyState){var a=this.faceLandmarker.detectForVideo(t,performance.now());a.faceLandmarks&&a.faceLandmarks.length>0&&(this.update3DPosition(a.faceLandmarks[0]),a.facialTransformationMatrixes&&a.facialTransformationMatrixes.length>0&&this.update3DRotationOnly(a.facialTransformationMatrixes[0].data))}},s.update3DPosition=function(e){var t=e[1],a=e[33],r=e[263],n=p.getVisibleSize(),i=n.width/n.height,o="user"===this._currentFacingMode?1-t.x:t.x,s=1-t.y,c=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2))/.25*5-19;c=f.clamp(c,-19,-8);var u=this.mainCamera.fov/2*(Math.PI/180),l=Math.tan(u)*Math.abs(c),m=(2*o-1)*(l*i),h=(2*s-1)*l,g=new d(m,h,c);this.target3DNode.setPosition(g),console.log("3D Position: X="+m.toFixed(2)+", Y="+h.toFixed(2)+", Z="+c.toFixed(2))},s.update3DRotationOnly=function(e){var t=new m;m.set(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]);var a=new h;if(t.getRotation(a),"user"===this._currentFacingMode){var r=new d;a.getEulerAngles(r),h.fromEuler(a,r.x,-r.y,-r.z)}this.target3DNode.setRotation(a)},t}(g)).prototype,"webcamSvc",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(F.prototype,"target3DNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(F.prototype,"mainCamera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=F))||D));s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./FaceTrackingManager3D.ts","./MainManager.ts","./PlaneFitter.ts","./QuizManager.ts","./WebcamTexture.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var e,t,s,a,o,r;return{setters:[function(n){e=n.inheritsLoose,t=n.createClass},function(n){s=n.cclegacy,a=n._decorator,o=n.director,r=n.Component}],execute:function(){var i,c;s._RF.push({},"240783QuM1C8pu/qEqU8s9A","MainManager",void 0);var u=a.ccclass;a.property,n("MainManager",u("MainManager")(((c=function(n){function s(){for(var e,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return(e=n.call.apply(n,[this].concat(s))||this)._answers={},e}e(s,n);var a=s.prototype;return a.onLoad=function(){s._instance&&s._instance!==this?this.node.destroy():(s._instance=this,o.addPersistRootNode(this.node))},a.start=function(){},a.update=function(n){},a.loadARScene=function(){console.log(this._answers+"121231321"),o.loadScene("AR")},t(s,[{key:"answers",get:function(){return this._answers},set:function(n){this._answers=n,console.log("MainManager 收到答案：",this._answers)}}],[{key:"instance",get:function(){return this._instance||console.warn("MainGame 還沒有被綁定到 Node 上！"),this._instance}}]),s}(r))._instance=null,i=c))||i);s._RF.pop()}}}));

System.register("chunks:///_virtual/PlaneFitter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r,n,a,o,c,s,l,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,c=t.Camera,s=t.Vec3,l=t.view,u=t.Component}],execute:function(){var p,f,h,d,g,m,y,v;a._RF.push({},"dc11eGUx9pOfqreWjtr3Qto","PlaneFitter",void 0);var P=o.ccclass,C=o.property,b=o.executeInEditMode;t("PlaneFitter",(p=P("PlaneFitter"),f=b(!0),h=C(c),d=C({tooltip:"是否每一幀都重新計算 (若相機 FOV 或 Plane 位置會變動則勾選)"}),p(g=f((y=e((m=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,r(e,"targetCamera",y,n(e)),r(e,"isDynamic",v,n(e)),e}i(e,t);var a=e.prototype;return a.start=function(){this.fit()},a.update=function(t){(this.isDynamic||CC_EDITOR)&&this.fit()},a.fit=function(){if(this.targetCamera&&this.node){var t=this.targetCamera.node.worldPosition,e=this.node.worldPosition,i=s.distance(t,e);if(!(i<=0)){var r=this.targetCamera.fov,n=l.getVisibleSize(),a=n.width/n.height,o=r/2*(Math.PI/180),c=2*Math.tan(o)*i,u=c*a/10,p=c/10;this.node.setScale(new s(u,1,p))}}},e}(u)).prototype,"targetCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(m.prototype,"isDynamic",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=m))||g)||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/QuizManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MainManager.ts"],(function(t){var e,n,i,o,r,s,l,a,u,c,p,h,d,g,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,l=t.Label,a=t.Button,u=t.SpriteFrame,c=t.Node,p=t.EventHandler,h=t.Sprite,d=t.Color,g=t.Component},function(t){b=t.MainManager}],execute:function(){var x,f,B,w,_,v,L,m,y,I,z,C,S,Q,M,O,q,F,P,A,D,R,k;r._RF.push({},"34530+z/RJByL2nJOR528Y2","QuizManager",void 0);var T=s.ccclass,E=s.property,H=[{id:"1",title:"Q1｜此刻你的「能量 × 感受」最接近哪一格？",question:"請依照此刻的感覺作答；沒有標準答案。",options:[{id:"A",text:"高能量 × 不舒服（焦躁、緊張）"},{id:"B",text:"高能量 × 舒服（興奮、期待）"},{id:"C",text:"低能量 × 不舒服（沮喪、疲倦）"},{id:"D",text:"低能量 × 舒服（平靜、放鬆）"}]},{id:"2",title:"Q2｜此刻你最明顯的身體訊號是？",question:"",options:[{id:"A",text:"心跳偏快／手心出汗"},{id:"B",text:"肩頸僵硬／下顎緊繃"},{id:"C",text:"呼吸變淺／胸口發緊"},{id:"D",text:"胃部不適／全身沈重"}]},{id:"3",title:"Q3｜此刻你最需要哪一種支持？",question:"",options:[{id:"A",text:"先穩定身體感受（呼吸放鬆）"},{id:"B",text:"把事情排出來（訂下行動步驟）"},{id:"C",text:"有人支持著我／靠著一下（被支持感）"},{id:"D",text:"一個調整與自我修復的空間"}]}];t("QuizManager",(x=T("QuizManager"),f=E(l),B=E(l),w=E([a]),_=E([l]),v=E(a),L=E(u),m=E(u),y=E(l),I=E(c),z=E(l),x((Q=e((S=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"titleLabel",Q,o(e)),i(e,"questionLabel",M,o(e)),i(e,"optionBtns",O,o(e)),i(e,"optionLabels",q,o(e)),i(e,"nextButton",F,o(e)),i(e,"nextButtonText",P,o(e)),i(e,"nextButtonFinal",A,o(e)),i(e,"progressLabel",D,o(e)),i(e,"resultPanel",R,o(e)),i(e,"resultLabel",k,o(e)),e._currentIndex=0,e._selectedOptionIndex=-1,e._answers={},e._isAnswered=!1,e}n(e,t);var r=e.prototype;return r.start=function(){this.Init(),this.resultPanel&&(this.resultPanel.active=!1);for(var t=0;t<this.optionBtns.length;t++){var e=this.optionBtns[t],n=new p;n.target=this.node,n.component="QuizManager",n.handler="onClickOptionButton",n.customEventData=t.toString(),e.clickEvents.push(n)}this.nextButton.node.on(a.EventType.CLICK,this.onSendButtonClick,this)},r.Init=function(){this._currentIndex=0,this._answers={},this._isAnswered=!1,this._selectedOptionIndex,this.resetSelectButtons(),this.showCurrentQuestion(),this.nextButton.getComponent(h).spriteFrame=this.nextButtonText},r.showCurrentQuestion=function(){var t=H[this._currentIndex];if(t){this.titleLabel&&(this.titleLabel.string=t.title),this.questionLabel&&(this.questionLabel.string=t.question||"");for(var e=0;e<this.optionLabels.length;e++){var n=this.optionLabels[e],i=t.options[e];n&&i&&(n.string=i.id+". "+i.text)}this.progressLabel&&(this.progressLabel.string=this._currentIndex+1+" / "+H.length),this._currentIndex+1==H.length&&(this.nextButton.getComponent(h).spriteFrame=this._currentIndex+1==H.length?this.nextButtonFinal:this.nextButtonText)}},r.onClickOptionButton=function(t,e){var n=parseInt(e,10);console.log(n),this.toggleSelectButton(n),this._selectedOptionIndex=n;var i=H[this._currentIndex];if(i){var o=i.options[n];o&&(this._answers[i.id]=o.id)}},r.onSendButtonClick=function(){-1!=this._selectedOptionIndex?(this._currentIndex<H.length-1?(this._currentIndex++,this.showCurrentQuestion()):this.showResult(),this._selectedOptionIndex=-1,this.resetSelectButtons()):console.log("請先選擇一個選項")},r.toggleSelectButton=function(t){for(var e=0;e<this.optionBtns.length;e++){var n=this.optionBtns[e].getComponent("cc.Sprite");n.color=e==t?new d(0,255,0):new d(255,255,255)}},r.resetSelectButtons=function(){this._selectedOptionIndex;for(var t=0;t<this.optionBtns.length;t++){this.optionBtns[t].getComponent("cc.Sprite").color=new d(255,255,255)}},r.showResult=function(){for(var t="你的作答結果：\n\n",e=0,n=H;e<n.length;e++){var i=n[e],o=this._answers[i.id]||"-";t+=i.id+"：選擇 "+o+"\n"}console.log(b.instance.node.name),console.log(t),console.log(this._answers),this.resultLabel&&(this.resultLabel.string=t),this.resultPanel&&(this.resultPanel.active=!0),b.instance.answers=this._answers,b.instance.loadARScene()},e}(g)).prototype,"titleLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(S.prototype,"questionLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(S.prototype,"optionBtns",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),q=e(S.prototype,"optionLabels",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=e(S.prototype,"nextButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=e(S.prototype,"nextButtonText",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=e(S.prototype,"nextButtonFinal",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=e(S.prototype,"progressLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(S.prototype,"resultPanel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(S.prototype,"resultLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=S))||C));r._RF.pop()}}}));

System.register("chunks:///_virtual/WebcamTexture.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,s,a,o,c,u,h,d,l,p,v,_,f,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,s=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,c=e._decorator,u=e.Enum,h=e.Sprite,d=e.MeshRenderer,l=e.Texture2D,p=e.SpriteFrame,v=e.Vec3,_=e.UITransform,f=e.Component,m=e.sys}],execute:function(){var y,g,w,x,b,M,S,R,D;o._RF.push({},"d4dc2rhnBJANL+VEGy8SqL6","WebcamTexture",void 0);var z=c.ccclass,F=c.property,T=function(e){return e[e.Sprite_2D=0]="Sprite_2D",e[e.Plane_3D=1]="Plane_3D",e}(T||{});u(T);e("WebcamTexture",(y=z("WebcamTexture"),g=F({type:T,tooltip:"選擇顯示模式：2D Sprite 或 3D Plane"}),w=F({type:h,visible:function(){return this.displayMode===T.Sprite_2D}}),x=F({type:d,visible:function(){return this.displayMode===T.Plane_3D}}),y((S=t((M=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,r(t,"displayMode",S,n(t)),r(t,"cameraSprite",R,n(t)),r(t,"cameraMesh",D,n(t)),t._video=null,t._canvas=null,t._ctx=null,t._texture=null,t._ready=!1,t._resizeRAF=0,t._currentFacingMode="environment",t.queueReflow=function(){t._resizeRAF||(t._resizeRAF=requestAnimationFrame((function(){t._resizeRAF=0,t.reflow()})))},t}i(t,e);var o=t.prototype;return o.onLoad=function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m.isBrowser){e.next=2;break}return e.abrupt("return");case 2:return this.setupVideoElement(),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas),this._canvas.style.display="none",e.next=9,this.startCamera(this._currentFacingMode);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.setupVideoElement=function(){this._video=document.createElement("video"),this._video.setAttribute("autoplay",""),this._video.setAttribute("muted",""),this._video.setAttribute("playsinline","")},o.startCamera=function(){var e=s(a().mark((function e(t){var i,r,n=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ready=!1,this._currentFacingMode=t,null!=(i=this._video)&&i.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({video:{facingMode:t},audio:!1});case 6:return r=e.sent,this._video.srcObject=r,e.next=10,new Promise((function(e){n._video.onloadedmetadata=function(){n._video.play(),e()}}));case 10:this.initTexture(),this.setupResizeListeners(),this._ready=!0,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.error("無法取得攝影機：",e.t0);case 18:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t){return e.apply(this,arguments)}}(),o.toggleCamera=function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="user"===this._currentFacingMode?"environment":"user",e.next=3,this.startCamera(t);case 3:console.log("切換鏡頭至: "+t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.getFacingMode=function(){return this._currentFacingMode},o.initTexture=function(){var e=this._video.videoWidth,t=this._video.videoHeight;if(this._canvas.width=e,this._canvas.height=t,this._texture||(this._texture=new l),this._texture.reset({width:e,height:t,format:l.PixelFormat.RGB888}),this.displayMode===T.Sprite_2D&&this.cameraSprite){var i=new p;i.texture=this._texture,this.cameraSprite.spriteFrame=i}else if(this.displayMode===T.Plane_3D&&this.cameraMesh){var r=this.cameraMesh.getMaterialInstance(0);r&&r.setProperty("mainTexture",this._texture)}this.reflow()},o.setupResizeListeners=function(){var e,t;window.removeEventListener("resize",this.queueReflow),window.addEventListener("resize",this.queueReflow),null==(e=this._video)||e.removeEventListener("resize",this.queueReflow),null==(t=this._video)||t.addEventListener("resize",this.queueReflow),this.queueReflow()},o.reflow=function(){this._ready&&this._video&&(this.displayMode===T.Sprite_2D?this.fitSpriteToParentHeight(this._video.videoHeight):this.fitPlaneToVideoRatio())},o.fitPlaneToVideoRatio=function(){if(this.cameraMesh&&this._video){var e=this._video.videoWidth/this._video.videoHeight,t="user"===this._currentFacingMode?-e:e;this.cameraMesh.node.setScale(new v(t,1,1))}},o.fitSpriteToParentHeight=function(e){var t;if(this.cameraSprite){var i=this.cameraSprite.node,r=null==(t=i.parent)?void 0:t.getComponent(_),n=i.getComponent(_);if(n&&r){n.setContentSize(n.width,e);var s=r.height/e;i.setScale(s,s,1)}}},o.update=function(){this._ready&&this._video&&this._canvas&&this._ctx&&this._texture&&(this._ctx.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),this._texture.uploadData(this._canvas))},o.onDestroy=function(){var e;null!=(e=this._video)&&e.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),window.removeEventListener("resize",this.queueReflow)},t}(f)).prototype,"displayMode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.Sprite_2D}}),R=t(M.prototype,"cameraSprite",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(M.prototype,"cameraMesh",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=M))||b));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});