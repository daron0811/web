System.register("chunks:///_virtual/EffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MainManager.ts"],(function(e){var t,n,r,i,l,a,o,s,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,a=e._decorator,o=e.Node,s=e.Component},function(e){c=e.MainManager}],execute:function(){var h,u,f,g,p,m,w,v,_;l._RF.push({},"7de44qmV6RAL5GYx7L1BRGU","EffectManager",void 0);var b=a.ccclass,y=a.property;e("EffectManager",(h=b("EffectManager"),u=y([o]),f=y([o]),g=y([o]),h((w=t((m=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,r(t,"helmeltA",w,i(t)),r(t,"helmeltB",v,i(t)),r(t,"helmeltC",_,i(t)),t._answers={},t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.onEnable=function(){null!=c.instance?(this._answers=c.instance.answers,this.ShowHelmet()):console.log("MainManager instance is null")},l.ShowHelmet=function(){console.log(0==this._answers[1]),console.log(this._answers);for(var e=0;e<this.helmeltA.length;e++)e==this._answers[1]&&(console.log("show A"+e),this.helmeltA[e].active=!0);for(var t=0;t<this.helmeltB.length;t++)console.log(t==this._answers[2]),this.helmeltB[t].active=t==this._answers[2];for(var n=0;n<this.helmeltC.length;n++)console.log(n==this._answers[3]),this.helmeltC[n].active=n==this._answers[3]},t}(s)).prototype,"helmeltA",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=t(m.prototype,"helmeltB",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=t(m.prototype,"helmeltC",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p=m))||p));l._RF.pop()}}}));

System.register("chunks:///_virtual/FaceTrackingManager3D.ts",["./rollupPluginModLoBabelHelpers.js","cc","./vision_bundle.mjs","./WebcamTexture.ts"],(function(e){var t,a,r,n,i,o,c,s,u,l,p,f,d,m,h,g,v,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){c=e.cclegacy,s=e._decorator,u=e.Node,l=e.Camera,p=e.math,f=e.Vec3,d=e.Mat4,m=e.Quat,h=e.Component},function(e){g=e.FaceLandmarker,v=e.FilesetResolver},function(e){M=e.WebcamTexture}],execute:function(){var b,w,y,k,D,x,F,T,_,L,P;c._RF.push({},"e89a2USrTtByKZVMQCimkAD","FaceTrackingManager3D",void 0);var S=s.ccclass,N=s.property;e("FaceTrackingManager3D",(b=S("FaceTrackingManager3D"),w=N(M),y=N(u),k=N(l),D=N({tooltip:"調整道具的基礎縮放比例"}),b((T=t((F=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,r(t,"webcamSvc",T,n(t)),r(t,"target3DNode",_,n(t)),r(t,"mainCamera",L,n(t)),r(t,"scaleMultiplier",P,n(t)),t.faceLandmarker=null,t._currentFacingMode="environment",t}a(t,e);var c=t.prototype;return c.start=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMediaPipe();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.initMediaPipe=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");case 2:return t=e.sent,e.next=5,g.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},outputFacialTransformationMatrixes:!0,runningMode:"VIDEO",numFaces:1});case 5:this.faceLandmarker=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.update=function(e){var t=this.webcamSvc._video;if(this.faceLandmarker&&t&&4===t.readyState){var a=this.faceLandmarker.detectForVideo(t,performance.now());a.faceLandmarks&&a.faceLandmarks.length>0?(this.target3DNode.active=!0,this.update3DPosition(a.faceLandmarks[0]),a.facialTransformationMatrixes&&a.facialTransformationMatrixes.length>0&&this.update3DRotationOnly(a.facialTransformationMatrixes[0].data)):this.target3DNode.active=!1}},c.update3DPosition=function(e){var t=e[1],a=e[33],r=e[263],n=9/16,i=this.webcamSvc._video,o=i.videoWidth/i.videoHeight,c=t.x;if(o>n){var s=n/o,u=(1-s)/2;c=(t.x-u)/s}"user"===this.webcamSvc.getFacingMode()&&(c=c);var l=1-t.y,d=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)),m=d/.25*10-25;m=p.clamp(m,-25,-5);var h=this.mainCamera.fov/2*(Math.PI/180),g=Math.tan(h)*Math.abs(m),v=g*n,M=(2*c-1)*v,b=(2*l-1)*g;this.target3DNode.setPosition(new f(M,b,m));var w=2*v*d*this.scaleMultiplier;this.target3DNode.setScale(new f(w,w,w))},c.update3DRotationOnly=function(e){var t=new d;d.set(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]);var a=new m;if(t.getRotation(a),"user"===this._currentFacingMode){var r=new f;a.getEulerAngles(r),m.fromEuler(a,r.x,-r.y,-r.z)}this.target3DNode.setRotation(a)},t}(h)).prototype,"webcamSvc",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(F.prototype,"target3DNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(F.prototype,"mainCamera",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(F.prototype,"scaleMultiplier",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),x=F))||x));c._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./EffectManager.ts","./FaceTrackingManager3D.ts","./MainManager.ts","./PlaneFitter.ts","./QuizManager.ts","./UIManager.ts","./WebcamTexture.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var e,t,s,a,o,r;return{setters:[function(n){e=n.inheritsLoose,t=n.createClass},function(n){s=n.cclegacy,a=n._decorator,o=n.director,r=n.Component}],execute:function(){var i,c;s._RF.push({},"240783QuM1C8pu/qEqU8s9A","MainManager",void 0);var u=a.ccclass;a.property,n("MainManager",u("MainManager")(((c=function(n){function s(){for(var e,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return(e=n.call.apply(n,[this].concat(s))||this)._answers={},e}e(s,n);var a=s.prototype;return a.onLoad=function(){s._instance&&s._instance!==this?this.node.destroy():(s._instance=this,o.addPersistRootNode(this.node))},a.start=function(){},a.update=function(n){},a.loadARScene=function(){console.log(this._answers+"121231321"),o.loadScene("AR")},t(s,[{key:"answers",get:function(){return this._answers},set:function(n){this._answers=n,console.log("MainManager 收到答案：",this._answers)}}],[{key:"instance",get:function(){return this._instance||console.warn("MainGame 還沒有被綁定到 Node 上！"),this._instance}}]),s}(r))._instance=null,i=c))||i);s._RF.pop()}}}));

System.register("chunks:///_virtual/PlaneFitter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r,n,a,o,c,s,l,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,c=t.Camera,s=t.Vec3,l=t.view,u=t.Component}],execute:function(){var p,f,h,d,g,m,y,v;a._RF.push({},"dc11eGUx9pOfqreWjtr3Qto","PlaneFitter",void 0);var P=o.ccclass,C=o.property,b=o.executeInEditMode;t("PlaneFitter",(p=P("PlaneFitter"),f=b(!0),h=C(c),d=C({tooltip:"是否每一幀都重新計算 (若相機 FOV 或 Plane 位置會變動則勾選)"}),p(g=f((y=e((m=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,r(e,"targetCamera",y,n(e)),r(e,"isDynamic",v,n(e)),e}i(e,t);var a=e.prototype;return a.start=function(){this.fit()},a.update=function(t){(this.isDynamic||CC_EDITOR)&&this.fit()},a.fit=function(){if(this.targetCamera&&this.node){var t=this.targetCamera.node.worldPosition,e=this.node.worldPosition,i=s.distance(t,e);if(!(i<=0)){var r=this.targetCamera.fov,n=l.getVisibleSize(),a=n.width/n.height,o=r/2*(Math.PI/180),c=2*Math.tan(o)*i,u=c*a/10,p=c/10;this.node.setScale(new s(u,1,p))}}},e}(u)).prototype,"targetCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(m.prototype,"isDynamic",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=m))||g)||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/QuizManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MainManager.ts"],(function(t){var e,n,i,r,o,s,l,a,u,c,p,h,b,d,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,s=t._decorator,l=t.Label,a=t.Button,u=t.SpriteFrame,c=t.Node,p=t.Sprite,h=t.Color,b=t.EventHandler,d=t.Component},function(t){g=t.MainManager}],execute:function(){var x,B,f,w,_,m,v,L,y,I,z,C,S,q,Q,F,M,O,G,P,A,D,R,k,T,E,H,J,j;o._RF.push({},"34530+z/RJByL2nJOR528Y2","QuizManager",void 0);var K=s.ccclass,N=s.property,Y=[{id:"1",title:"Q1｜此刻你的「能量 × 感受」最接近哪一個？",question:"請依照此刻的感覺作答；沒有標準答案。",options:[{id:"A",text:"高能量 × 不舒服（焦躁、緊張）"},{id:"B",text:"高能量 × 舒服（興奮、期待）"},{id:"C",text:"低能量 × 不舒服（沮喪、疲倦）"},{id:"D",text:"低能量 × 舒服（平靜、放鬆）"}]},{id:"2",title:"Q2｜此刻你最明顯的身體訊號是？",question:"",options:[{id:"A",text:"身體輕鬆、呼吸順暢"},{id:"B",text:"有力量、準備好的感覺"},{id:"C",text:"平平的、沒什麼特別感覺"},{id:"D",text:"身體緊繃或卡卡的"},{id:"E",text:"提不起勁、想躺下"}]},{id:"3",title:"Q3｜此刻你最需要哪一種支持？",question:"",options:[{id:"A",text:"先穩定身體節奏"},{id:"B",text:"把事情拆小步"},{id:"C",text:"有人安靜在旁、可靠一下"},{id:"D",text:"一個溫暖擁抱／自我擁抱"}]}];t("QuizManager",(x=K("QuizManager"),B=N(l),f=N(l),w=N([a]),_=N([l]),m=N(a),v=N(u),L=N(u),y=N(l),I=N(c),z=N(l),C=N(p),S=N(u),q=N(h),x((M=e((F=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o))||this,i(e,"titleLabel",M,r(e)),i(e,"questionLabel",O,r(e)),i(e,"optionBtns",G,r(e)),i(e,"optionLabels",P,r(e)),i(e,"nextButton",A,r(e)),i(e,"nextButtonText",D,r(e)),i(e,"nextButtonFinal",R,r(e)),i(e,"progressLabel",k,r(e)),i(e,"resultPanel",T,r(e)),i(e,"resultLabel",E,r(e)),i(e,"quitBG",H,r(e)),i(e,"quitBGSprites",J,r(e)),i(e,"selectBtnColors",j,r(e)),e._currentIndex=0,e._selectedOptionIndex=-1,e._answers={},e._isAnswered=!1,e}n(e,t);var o=e.prototype;return o.start=function(){this.Init(),this.resultPanel&&(this.resultPanel.active=!1);for(var t=0;t<this.optionBtns.length;t++){var e=this.optionBtns[t],n=new b;n.target=this.node,n.component="QuizManager",n.handler="onClickOptionButton",n.customEventData=t.toString(),e.clickEvents.push(n)}this.nextButton.node.on(a.EventType.CLICK,this.onSendButtonClick,this)},o.Init=function(){this._currentIndex=0,this._answers={},this._isAnswered=!1,this._selectedOptionIndex,this.resetSelectButtons(),this.showCurrentQuestion(),this.nextButton.getComponent(p).spriteFrame=this.nextButtonText,this.quitBG.spriteFrame=this.quitBGSprites[0]},o.showCurrentQuestion=function(){var t=Y[this._currentIndex];if(t){this.titleLabel&&(this.titleLabel.string=t.title),this.questionLabel&&(this.questionLabel.string=t.question||"");for(var e=0;e<this.optionLabels.length;e++){var n=this.optionLabels[e],i=t.options[e];n&&i&&(n.string=i.id+". "+i.text)}this.quitBG.spriteFrame=this.quitBGSprites[this._currentIndex],this.progressLabel&&(this.progressLabel.string=this._currentIndex+1+" / "+Y.length),this._currentIndex+1==Y.length&&(this.nextButton.getComponent(p).spriteFrame=this._currentIndex+1==Y.length?this.nextButtonFinal:this.nextButtonText)}},o.onClickOptionButton=function(t,e){var n=parseInt(e,10);console.log(n),this.toggleSelectButton(n),this._selectedOptionIndex=n;var i=Y[this._currentIndex];i&&(i.options[n]&&(this._answers[i.id]=n))},o.onSendButtonClick=function(){-1!=this._selectedOptionIndex?(this._currentIndex<Y.length-1?(this._currentIndex++,this.showCurrentQuestion()):this.showResult(),this._selectedOptionIndex=-1,this.resetSelectButtons()):console.log("請先選擇一個選項")},o.toggleSelectButton=function(t){for(var e=0;e<this.optionBtns.length;e++){var n=this.optionBtns[e].getComponent("cc.Sprite");n.color=e==t?this.selectBtnColors[this._currentIndex]:new h(255,255,255)}},o.resetSelectButtons=function(){this._selectedOptionIndex;for(var t=0;t<this.optionBtns.length;t++){this.optionBtns[t].getComponent("cc.Sprite").color=new h(255,255,255)}},o.showResult=function(){for(var t="你的作答結果：\n\n",e=0,n=Y;e<n.length;e++){var i=n[e],r=this._answers[i.id]||"-";t+=i.id+"：選擇 "+r+"\n"}console.log(g.instance.node.name),console.log(t),console.log(this._answers),this.resultLabel&&(this.resultLabel.string=t),this.resultPanel&&(this.resultPanel.active=!0),g.instance.answers=this._answers,g.instance.loadARScene()},e}(d)).prototype,"titleLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(F.prototype,"questionLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(F.prototype,"optionBtns",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P=e(F.prototype,"optionLabels",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=e(F.prototype,"nextButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=e(F.prototype,"nextButtonText",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=e(F.prototype,"nextButtonFinal",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=e(F.prototype,"progressLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(F.prototype,"resultPanel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(F.prototype,"resultLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(F.prototype,"quitBG",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=e(F.prototype,"quitBGSprites",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=e(F.prototype,"selectBtnColors",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=F))||Q));o._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,n,o,s,r,a,c,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.createClass},function(e){r=e.cclegacy,a=e._decorator,c=e.Node,l=e.Component}],execute:function(){var u,d,h,N,p,f,v,g,y,b;r._RF.push({},"92b55VMWOFHwqxq/vY/aAwr","UIManager",void 0);var q=a.ccclass,_=a.property;e("UIManager",(u=q("UIManager"),d=_(c),h=_(c),N=_(c),u(((b=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t=e.call.apply(e,[this].concat(s))||this,n(t,"titleNode",v,o(t)),n(t,"descNode",g,o(t)),n(t,"quitNode",y,o(t)),t}i(t,e);var r=t.prototype;return r.onLoad=function(){t._instance&&t._instance!==this?this.node.destroy():(t._instance=this,this.onReset())},r.onReset=function(){this.titleNode&&(this.titleNode.active=!0),this.descNode&&(this.descNode.active=!1),this.quitNode&&(this.quitNode.active=!1)},r.showDesc=function(){this.titleNode&&(this.titleNode.active=!1),this.descNode&&(this.descNode.active=!0),this.quitNode&&(this.quitNode.active=!1)},r.showQuit=function(){this.titleNode&&(this.titleNode.active=!1),this.descNode&&(this.descNode.active=!1),this.quitNode&&(this.quitNode.active=!0)},s(t,null,[{key:"instance",get:function(){return this._instance||console.warn("UIManager 還沒有被綁定到 Node 上！"),this._instance}}]),t}(l))._instance=null,v=t((f=b).prototype,"titleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(f.prototype,"descNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(f.prototype,"quitNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/WebcamTexture.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,a,s,o,c,u,h,l,d,p,v,_,f,m,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){o=e.cclegacy,c=e._decorator,u=e.Enum,h=e.Sprite,l=e.MeshRenderer,d=e.Label,p=e.Texture2D,v=e.SpriteFrame,_=e.Vec3,f=e.UITransform,m=e.Component,g=e.sys}],execute:function(){var y,w,b,x,T,R,M,A,S,D,E;o._RF.push({},"d4dc2rhnBJANL+VEGy8SqL6","WebcamTexture",void 0);var F=c.ccclass,z=c.property,L=function(e){return e[e.Sprite_2D=0]="Sprite_2D",e[e.Plane_3D=1]="Plane_3D",e}(L||{});u(L);e("WebcamTexture",(y=F("WebcamTexture"),w=z({type:L,tooltip:"選擇顯示模式：2D Sprite 或 3D Plane"}),b=z({type:h,visible:function(){return this.displayMode===L.Sprite_2D}}),x=z({type:l,visible:function(){return this.displayMode===L.Plane_3D}}),T=z(d),y((A=t((M=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,r(t,"displayMode",A,n(t)),r(t,"cameraSprite",S,n(t)),r(t,"cameraMesh",D,n(t)),r(t,"logLabel",E,n(t)),t._video=null,t._canvas=null,t._ctx=null,t._texture=null,t._ready=!1,t._resizeRAF=0,t._currentFacingMode="user",t.TARGET_RATIO=9/16,t.queueReflow=function(){t._resizeRAF||(t._resizeRAF=requestAnimationFrame((function(){t._resizeRAF=0,t.reflow()})))},t}i(t,e);var o=t.prototype;return o.onLoad=function(){var e=a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isBrowser){e.next=2;break}return e.abrupt("return");case 2:return this.setupVideoElement(),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas),this._canvas.style.display="none",e.next=9,this.startCamera(this._currentFacingMode);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.setupVideoElement=function(){this._video=document.createElement("video"),this._video.setAttribute("autoplay",""),this._video.setAttribute("muted",""),this._video.setAttribute("playsinline","")},o.startCamera=function(){var e=a(s().mark((function e(t){var i,r,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ready=!1,this._currentFacingMode=t,null!=(i=this._video)&&i.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({video:{facingMode:t},audio:!1});case 6:return r=e.sent,this._video.srcObject=r,e.next=10,new Promise((function(e){n._video.onloadedmetadata=function(){n._video.play(),e()}}));case 10:this.initTexture(),this.setupResizeListeners(),this._ready=!0,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.error("無法取得攝影機：",e.t0);case 18:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t){return e.apply(this,arguments)}}(),o.toggleCamera=function(){var e=a(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="user"===this._currentFacingMode?"environment":"user",e.next=3,this.startCamera(t);case 3:console.log("切換鏡頭至: "+t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.getFacingMode=function(){return this._currentFacingMode},o.initTexture=function(){var e=this._video.videoHeight,t=e*this.TARGET_RATIO;if(this._canvas.width=t,this._canvas.height=e,this._texture||(this._texture=new p),this._texture.reset({width:t,height:e,format:p.PixelFormat.RGB888}),this.displayMode===L.Sprite_2D&&this.cameraSprite){var i=new v;i.texture=this._texture,this.cameraSprite.spriteFrame=i}else if(this.displayMode===L.Plane_3D&&this.cameraMesh){var r=this.cameraMesh.getMaterialInstance(0);r&&r.setProperty("mainTexture",this._texture)}this.reflow()},o.setupResizeListeners=function(){var e,t;window.removeEventListener("resize",this.queueReflow),window.addEventListener("resize",this.queueReflow),null==(e=this._video)||e.removeEventListener("resize",this.queueReflow),null==(t=this._video)||t.addEventListener("resize",this.queueReflow),this.queueReflow()},o.reflow=function(){this._ready&&this._video&&(this.displayMode===L.Sprite_2D?this.fitSpriteToParentHeight(this._video.videoHeight):this.fitPlaneToVideoRatio())},o.fitPlaneToVideoRatio=function(){if(this.cameraMesh){var e=this.TARGET_RATIO;this.logLabel&&(this.logLabel.string="Fixed Ratio: 9:16 ("+e.toFixed(4)+")");var t="user"===this._currentFacingMode?-e:e;this.cameraMesh.node.setScale(new _(t,1,1))}},o.fitSpriteToParentHeight=function(e){var t;if(this.cameraSprite){var i=this.cameraSprite.node,r=null==(t=i.parent)?void 0:t.getComponent(f),n=i.getComponent(f);if(n&&r){n.setContentSize(n.width,e);var a=r.height/e;i.setScale(a,a,1)}}},o.update=function(){if(this._ready&&this._video&&this._canvas&&this._ctx&&this._texture){var e=this._video.videoWidth,t=this._video.videoHeight,i=0,r=0,n=e,a=t;e/t>this.TARGET_RATIO?i=(e-(n=t*this.TARGET_RATIO))/2:r=(t-(a=e/this.TARGET_RATIO))/2,this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx.drawImage(this._video,i,r,n,a,0,0,this._canvas.width,this._canvas.height),this._texture.uploadData(this._canvas)}},o.onDestroy=function(){var e;null!=(e=this._video)&&e.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),window.removeEventListener("resize",this.queueReflow)},t}(m)).prototype,"displayMode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L.Sprite_2D}}),S=t(M.prototype,"cameraSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(M.prototype,"cameraMesh",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(M.prototype,"logLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=M))||R));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});